\chapter{Аналитический раздел}
\label{cha:analysis}
%
% % В начале раздела  можно напомнить его цель
% IDEF0


В данном разделе производится анализ методов вычислений характеристик жидкостей и
их преобразований в графический формат.

Далее рассматриваются идеи применения данных методов к симуляции жидкостей и существующие решения в этой области.

% Обратите внимание, что включается не ../dia/..., а inc/dia/...
% В Makefile есть соответствующее правило для inc/dia/*.pdf, которое
% берет исходные файлы из ../dia в этом случае.

\section{Физическая модель}

Жидкости моделируются как векторное поле скорости жидкости и скалярное поле
плотности. Движение задаётся уравнениями Навье-Стокса \cite{inbook:bigenc}.

Далее рассматривается только движение воды (несжимаемой жидкости) в условиях постоянной температуры.

Тогда уравнения Навье-Стокса в векторной форме принимают следующий вид:
\begin{equation}
    \label{eq:navier-stokes}
    \frac{\partial \vec{v}}{\partial t} + \vec{v} \cdot \nabla\vec{v}= \vec{F} - \frac{1}{\rho} \nabla p + \eta\Delta\vec{v}.
\end{equation}

В уравнении \ref{eq:navier-stokes} $\vec{v}$ - скорость частицы воды,
                                   $t$ - время,
                                   ${\vec{F}}$ - внешняя удельная сила,
                                   $p$ - давление,
                                   $\eta = \frac{\mu}{\rho}$ - кинематический коэффициент вязкости,
                                   $\nabla$ - оператор Гамильтона,
                                   $\Delta$ - оператор Лапласа.

Данная физическая модель лежит в основе многих подходов симуляции жидкостей\cite{book:ash}. Их
обзор приведён далее.

В статистической физике модель поведения частиц жидкости описывается кинетическим
уравнением Больцмана. Данная модель применима для систем, где
есть ограничения на малую скорость частиц\cite{site:bolzman}.

\section{Существующие подходы к симуляции жидкостей}

В вычислениях поведения жидкости необходимо представить физическую модель в
 дискретном виде. Данную проблему решает вычислительная гидродинамика - совокупность
 теоретических, экспериментальных и численных методов, предназначенных для моделирования
 потоковых процессов.

Наиболее распространёнными методами описания характеристик жидкости в
вычислительной гидродинамике являются:
\begin{itemize}
    \item сеточные методы Эйлера;
    \item метод гидродинамики сглаженных частиц;
    \item методы, основанные на турбулентности;
    \item метод решёточных уравнений Больцмана.
\end{itemize}

Сеточные методы Эйлера являются наиболее простым решением симуляции жидкостей
Они заключаются в поиске решения задачи Коши для функций,
заданных таблично. Для каждого узла функции уровня жидкости
 требуется вычисление значений разложений Тейлора в их окрестностям. Решение задачи Коши
 в данном случае аппроксимирует решение уравнения Навье-Стокса\cite{book:compmath}.

Метод гидродинамики сглаженных частиц и методы, основанные на турбулентности,
заключаются в выборе размера частицы ("длины сглаживания"), на котором их свойства
"сглаживаются" посредством функции ядра или интерполяции, и решения уравнений
Навье-Стокса с учётом вязкости и плотности. Это позволяет эффективно моделировать
поведение жидкостей, газов и даже использовать в астрофизике\cite{site:astro}.

 Метод решёточных уравнений Больцмана основан на кинетическом уравнении Больцмана,
 упомянутом ранее. Этот метод поддерживает многофазные жидкости, наличие теплопроводности
 и граничные условия на макроскопическом уровне\cite{site:habr-physics}.

\section{Анализ методов визуализации жидкостей}

Основными требованиями к методам симуляции жидкостей со стороны компьютерной графики
являются визуальная правдоподобность и скорость анимации.

Исходя из этих условий, в компьютерной графике используются специально модифицированные
и оптимизированные методы, основанные на указанных ранее. При этом решается задача объёмного
рендеринга - на каждый кадр требуется найти проекцию трёхмерного дискретного набора данных
о жидкости\cite{article:fastvolume}.

В настоящее время существует всего 2 принципиально различных техники объёмного рендеринга:
трассировка лучей и реконструкция поверхности\cite{book:ash}.

\subsection{Трассировка лучей}

Данная техника состоит в том, чтобы создать виртуальный экран и далее проследить
путь луча до тех пор, пока он проходит сквозь анимируемые объекты. В итоге луч
позволяет определить цвет каждого отдельного пикселя. Настоящий алгоритм трассировки лучей
имеет значительную вычислительную сложность, поэтому его часто заменяют на
правдоподобные аппроксимации\cite{book:ash}.

Одним из способов аппроксимации является трассировки лучей путём
замены полигонов на вокселы. Это позволяет существенно повышать производительность
анимации за счёт возможностей параллелизма и снижения вычислительной сложности.
С другой стороны для хранения вокселей требуется большее количество
памяти, чем для хранения полигонов.

Другим популярным методом является метод срезов объёмных текстур так же, как и воксельный, является математическим упрощением алгоритма трассировки лучей.
Данные сцены представляются в виде 3D текстуры. Рендеринг производится с самого дальнего
 по отношению к наблюдателю слоя текстуры. В итоге видимыми являются ближайшие из частей
 слоя.
 В качестве составляющих срезов могут быть использованы как вокселы, так и полигоны.
 Этот способ оптимизирован аппаратно для некоторых графических процессоров
 и в этом случае имеет преимущество перед воксельным методом по времени работы.

\subsection{Реконструкция поверхности}

Реконструкцией поверхности, или трёхмерной реконструкцией, называют процесс
получения облика реальных объектов.

В качестве входных данных получают множество точек, характеризующее объект.
Далее выбирают точки на поверхности объекта так, что получают полигоны, которые
имеют необходимую конфигурацию для аппроксимации формы поверхности в её видимой части.
Набор результирующих полигонов - реконструированная модель.

Основным алгоритмом, реализующим этот метод, является Marching cubes.
Он широко используется в компьютерной и магнитно-резонансной томографии\cite{site:marchingcubes}.
Суть алгоритма в том, что для кубов, находящихся на поверхности объекта, известно,
какие точки лежат внутри объекта и какие снаружи. Это позволяет выбрать
приближающий полигон так, чтобы его вершины находились на отрезках, соединяющих вершины куба,
в примерных точках реального пересечения с объектом.
Таким образом, однажды применив алгоритм, можно использовать объект в анимации, если
он не изменяет форму поверхности.
Для предметов, теряющих форму, например, жидкостей требуется повторное вычисление
реконструированной поверхности. Подобные вычисления имеют значительную сложность,
поэтому на практике не используются\cite{book:ash}.

% вывод по разделу

\section{Оптимизации воксельного способа решения задачи объёмного рендеринга}

Существуют случаи, в которых система объёмного рендеринга получает на вход трёхмерные данные, в
 которых есть области, не требующие отрисовки. В подобных ситуациях следует пропускать вычисление
 результирующего изображения для пустого пространства\cite{article:asvo}.

Для хранения вокселов можно использовать различные структуры данных. Наиболее простой является
трёмерный массив вокселов. При хранении вокселов в виде массива может требоваться значительное
количество памяти, даже если исходная информация достаточно однородная.
Поэтому для оптимизации памяти применяют такие структуры данных, как октодерево и binary sparse
partitioning дерево\cite{article:asvo}.

Использование иерахических структур данных имеет следующий недостаток - они статичны, и их
использование для моделей, теряющих форму, требует перестроение всего дерева\cite{article:asvo}.

Поскольку вода теряет свою форму, были предложены оптимизации не для хранения вокселов, а для
обработки лучей и самих данных симуляции. Данные оптимизации основаны на принципах обработки
чисел с плавающих запятой на аппаратном обеспечении, а также на возможности дальнейшего
параллелизма вычислений\cite{book:ash}.

\section{Вывод}

Исходя из полученных сведений о достоинствах и недостатках каждого из методов объёмного
рендеринга в дальнейшем рассматривается реализация с помощью вокселей. Она обеспечивает
возможность изменения формы жидкости и наиболее быструю из предложенных техник трассировки лучей.

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "rpz"
%%% End:
